# CTFä¸­MD5ç»•è¿‡ä¸å¼±ç±»å‹æ¯”è¾ƒå®Œæ•´æŒ‡å—
---

## PHPå¼±ç±»å‹æ¯”è¾ƒåŸºç¡€

### å¼ºç±»å‹vså¼±ç±»å‹æ¯”è¾ƒ

|æ¯”è¾ƒæ–¹å¼|ç¬¦å·|ç‰¹ç‚¹|å®‰å…¨æ€§|
|---|---|---|---|
|å¼±ç±»å‹æ¯”è¾ƒ|`==`|ä¼šè¿›è¡Œç±»å‹è½¬æ¢|âš ï¸ å­˜åœ¨ç»•è¿‡é£é™©|
|å¼ºç±»å‹æ¯”è¾ƒ|`===`|ä¸è¿›è¡Œç±»å‹è½¬æ¢|âœ… ç›¸å¯¹å®‰å…¨|

### PHPç±»å‹è½¬æ¢è§„åˆ™

#### å­—ç¬¦ä¸²è½¬æ•°å­—è§„åˆ™

```php
// PHPç±»å‹è½¬æ¢ç¤ºä¾‹
var_dump("123" == 123);        // true
var_dump("123abc" == 123);     // true  
var_dump("abc123" == 0);       // true
var_dump("0e123" == 0);        // true (ç§‘å­¦è®¡æ•°æ³•)
var_dump("0e123" == "0e456");  // true (éƒ½ç­‰äº0)
```

#### æ•°ç»„ä¸å­—ç¬¦ä¸²æ¯”è¾ƒ

```php
// æ•°ç»„ä¸å­—ç¬¦ä¸²æ¯”è¾ƒ
var_dump(array() == "");       // true
var_dump(array() == 0);        // true
var_dump(array(0) == "0");     // true
```

### å¸¸è§å¼±ç±»å‹ç»•è¿‡åœºæ™¯

#### 1. ç§‘å­¦è®¡æ•°æ³•ç»•è¿‡

```php
// 0eå¼€å¤´çš„å­—ç¬¦ä¸²ä¼šè¢«å½“ä½œç§‘å­¦è®¡æ•°æ³•
"0e123" == "0e456"   // true (éƒ½ç­‰äº0)
"0e123" == 0         // true
```

#### 2. æ•°ç»„ç»•è¿‡

```php
// æ•°ç»„æ¯”è¾ƒç»•è¿‡
array() == ""        // true
array() == 0         // true
array() == false     // true
```

#### 3. NULLç»•è¿‡

```php
// NULLæ¯”è¾ƒç»•è¿‡
null == ""           // true
null == 0            // true
null == false        // true
```

---

## MD5å¼±ç±»å‹ç»•è¿‡

### åŸºæœ¬åŸç†

MD5å‡½æ•°å¯èƒ½è¿”å›`0e`å¼€å¤´çš„å“ˆå¸Œå€¼ï¼Œåœ¨å¼±ç±»å‹æ¯”è¾ƒä¸­è¢«è§†ä¸ºç§‘å­¦è®¡æ•°æ³•ï¼ˆå€¼ä¸º0ï¼‰ã€‚

### ç»å…¸Payload

#### 1. 0eç§‘å­¦è®¡æ•°æ³•Payload

```text
# MD5å€¼ä»¥0eå¼€å¤´çš„å­—ç¬¦ä¸²ï¼ˆå¼±ç±»å‹æ¯”è¾ƒæ—¶ç­‰äº0ï¼‰
240610708        # MD5: 0e462097431906509019562988736854
           # MD5: 0e830400451993494058024219903391
s878926199a      # MD5: 0e545993274517709034328855841020
s155964671a      # MD5: 0e342768416822451524974117254469
s214587387a      # MD5: 0e848240448830187420162954587645
s214587387a      # MD5: 0e848240448830187420162954587645
s1091221200a     # MD5: 0e940624217856561557816327384675
s1885207154a     # MD5: 0e509367213418206700842008763514
```

#### 2. å®æˆ˜åº”ç”¨åœºæ™¯

```php
// å…¸å‹çš„vulnerableä»£ç 
if(md5($_GET['a']) == md5($_GET['b']) && $_GET['a'] != $_GET['b']){
    echo "flag{xxx}";
}

// ç»•è¿‡æ–¹æ³•
// ?a=240610708&b=QNKCDZO
// md5("240610708") = 0e462097431906509019562988736854
// md5("QNKCDZO") = 0e830400451993494058024219903391  
// å¼±ç±»å‹æ¯”è¾ƒ: 0 == 0 ä¸º true
```

### æ•°ç»„ç»•è¿‡MD5

```php
// å½“è¾“å…¥ä¸ºæ•°ç»„æ—¶ï¼Œmd5()å‡½æ•°è¿”å›NULL
if(md5($_GET['a']) == md5($_GET['b']) && $_GET['a'] != $_GET['b']){
    echo "flag{xxx}";
}

// ç»•è¿‡æ–¹æ³•
// ?a[]=1&b[]=2
// md5(array()) è¿”å› NULL
// NULL == NULL ä¸º trueï¼Œä½† array(1) != array(2)
```

### POSTæ•°æ®ç»•è¿‡

```http
POST /challenge.php HTTP/1.1
Content-Type: application/x-www-form-urlencoded

a[]=1&b[]=2
```

---

## MD5å¼ºç±»å‹ç»•è¿‡

### åŸºæœ¬åŸç†

å½“ä»£ç ä½¿ç”¨å¼ºç±»å‹æ¯”è¾ƒï¼ˆ`===`ï¼‰æ—¶ï¼Œéœ€è¦æ‰¾åˆ°MD5å€¼å®Œå…¨ç›¸åŒçš„ä¸åŒå­—ç¬¦ä¸²ã€‚

### MD5ç¢°æ’Payload

#### 1. ç»å…¸MD5ç¢°æ’

```php
// è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„MD5å€¼å®Œå…¨ç›¸åŒ
$str1 = "M%C9h%CC%0C`%C9%D6o%E1%05t%00r%BB%8Cl%10Dz%C2%A2%ECT%10%5C%0F%8F%EFj";
$str2 = "M%C9h%CC%0C`%C9%D6o%E1%05t%00r%BB%8Cl%10Dz%C2%A2%ECT%10%5C%0F%8F%EFj";

// å®é™…ä½¿ç”¨æ—¶éœ€è¦URLè§£ç 
$collision1 = urldecode($str1);
$collision2 = urldecode($str2);
```

#### 2. å®ç”¨MD5ç¢°æ’å¯¹

```text
# ç¬¬ä¸€ç»„ç¢°æ’
4dc968ff0ee35c209572d4777b721587d36fa7b21bdc56b74a3dc0783e7b9518afbfa200a8284bf36e8e4b55b35f427593d849676da0d1555d8360fb5f07fea2
4dc968ff0ee35c209572d4777b721587d36fa7b21bdc56b74a3dc0783e7b9518afbfa202a8284bf36e8e4b55b35f427593d849676da0d1d55d8360fb5f07fea2

# ç¬¬äºŒç»„ç¢°æ’  
008ee33a9d58b51cfeb425b0959121c9-8dd5d92b032a65b1bb4e0df4a2b55a2b
008ee33a9d58b51cfeb425b0959121c9-3fd3e7b8c6a9b20e4a7d4b82a2b55a2b
```

### FastCollå·¥å…·ç”Ÿæˆç¢°æ’

```bash
# ä½¿ç”¨FastCollå·¥å…·ç”ŸæˆMD5ç¢°æ’
./fastcoll -p prefix.txt -o collision1.bin collision2.bin

# éªŒè¯ç¢°æ’
md5sum collision1.bin collision2.bin
```

---

## MD5ç¢°æ’æ”»å‡»

### ç†è®ºåŸºç¡€

MD5å­˜åœ¨å·²çŸ¥çš„ç¢°æ’æ¼æ´ï¼Œå¯ä»¥æ„é€ å‡ºå…·æœ‰ç›¸åŒMD5å€¼çš„ä¸åŒæ–‡ä»¶ã€‚

### å®é™…ç¢°æ’æ–‡ä»¶

#### 1. äºŒè¿›åˆ¶ç¢°æ’æ–‡ä»¶

```python
# Pythonç”ŸæˆMD5ç¢°æ’ç¤ºä¾‹
collision1 = bytes.fromhex('4dc968ff0ee35c209572d4777b721587d36fa7b21bdc56b74a3dc0783e7b9518afbfa200a8284bf36e8e4b55b35f427593d849676da0d1555d8360fb5f07fea2')
collision2 = bytes.fromhex('4dc968ff0ee35c209572d4777b721587d36fa7b21bdc56b74a3dc0783e7b9518afbfa202a8284bf36e8e4b55b35f427593d849676da0d1d55d8360fb5f07fea2')

import hashlib
print(hashlib.md5(collision1).hexdigest())  # è¾“å‡ºç›¸åŒMD5
print(hashlib.md5(collision2).hexdigest())  # è¾“å‡ºç›¸åŒMD5
```

#### 2. æ–‡ä»¶ä¸Šä¼ ç¢°æ’ç»•è¿‡

```php
// æ–‡ä»¶ä¸Šä¼ MD5æ ¡éªŒç»•è¿‡
if(md5_file($_FILES['file']['tmp_name']) === $expected_md5){
    // ä¸Šä¼ æˆåŠŸ
}

// ä½¿ç”¨ç¢°æ’æ–‡ä»¶ç»•è¿‡MD5æ ¡éªŒ
```

### åœ¨çº¿MD5ç¢°æ’å·¥å…·

- **HashClash**ï¼šç”ŸæˆMD5ç¢°æ’çš„å·¥å…·
- **FastColl**ï¼šå¿«é€ŸMD5ç¢°æ’ç”Ÿæˆå™¨
- **åœ¨çº¿å·¥å…·**ï¼šéƒ¨åˆ†ç½‘ç«™æä¾›MD5ç¢°æ’ç”ŸæˆæœåŠ¡

---

## SHA1ç»•è¿‡æŠ€å·§

### SHA1å¼±ç±»å‹ç»•è¿‡

#### 1. 0eç§‘å­¦è®¡æ•°æ³•SHA1

```text
# SHA1å€¼ä»¥0eå¼€å¤´çš„å­—ç¬¦ä¸²
aaroZmOk        # SHA1: 0e66507019969427134894567494305185566735
aaK1STfY        # SHA1: 0e76658526655756207688271159624026011393
aaO8zKZF        # SHA1: 0e89257456677279068558073954252716165668
aa3OFF9m        # SHA1: 0e36977786278517984959260394024281014729
```

#### 2. æ•°ç»„ç»•è¿‡SHA1

```php
// SHA1æ•°ç»„ç»•è¿‡
if(sha1($_GET['a']) == sha1($_GET['b']) && $_GET['a'] != $_GET['b']){
    echo "flag{xxx}";
}

// ç»•è¿‡ï¼š?a[]=1&b[]=2
```

### SHA1ç¢°æ’æ”»å‡»

```text
# è‘—åçš„SHA1ç¢°æ’æ ·æœ¬ï¼ˆSHAtteredæ”»å‡»ï¼‰
PDF1: 38762cf7f55934b34d179ae6a4c80cadccbb7f0a
PDF2: 38762cf7f55934b34d179ae6a4c80cadccbb7f0a

# è¿™ä¸¤ä¸ªä¸åŒçš„PDFæ–‡ä»¶å…·æœ‰ç›¸åŒçš„SHA1å€¼
```

---

## å…¶ä»–å“ˆå¸Œå‡½æ•°ç»•è¿‡

### CRC32ç»•è¿‡

```php
// CRC32å¼±ç±»å‹ç»•è¿‡
crc32("PLOE") == crc32("aAE0")  // true (æ•°å€¼ç›¸ç­‰)
```

### MD4ç»•è¿‡

```text
# MD4 0eç§‘å­¦è®¡æ•°æ³•
8E8RKF6Q        # MD4: 0e967641681823153728876084350301
```

### SHA256/SHA512ç»•è¿‡

è™½ç„¶SHA256å’ŒSHA512æ›´å®‰å…¨ï¼Œä½†ä»ç„¶å­˜åœ¨å¼±ç±»å‹ç»•è¿‡ï¼š

```php
// æ•°ç»„ç»•è¿‡
hash('sha256', array()) == hash('sha256', array())  // true (éƒ½è¿”å›NULL)
```

---

## JSONå¼±ç±»å‹ç»•è¿‡

### JSONè§£æç»•è¿‡

#### 1. æ•°å­—ä¸å­—ç¬¦ä¸²æ··æ·†

```json
{
    "password": 123456,
    "admin": true
}

// PHPè§£æåå¯èƒ½è¢«å½“ä½œå­—ç¬¦ä¸²"123456"
```

#### 2. å¸ƒå°”å€¼ç»•è¿‡

```json
{
    "admin": true,
    "level": 1
}

// åœ¨å¼±ç±»å‹æ¯”è¾ƒä¸­ï¼štrue == 1 ä¸º true
```

### JSONæ•°ç»„ç»•è¿‡

```json
{
    "a": [],
    "b": []
}

// ç©ºæ•°ç»„åœ¨PHPä¸­å¯èƒ½è¢«è½¬æ¢ä¸ºç›¸åŒå€¼
```

---

## å®æˆ˜Payloadåˆé›†

### 1. MD5å¼±ç±»å‹ç»•è¿‡åˆé›†

```text
# æœ€å¸¸ç”¨çš„MD5å¼±ç±»å‹Payload
240610708        â†’ 0e462097431906509019562988736854
QNKCDZO          â†’ 0e830400451993494058024219903391  
s878926199a      â†’ 0e545993274517709034328855841020
s155964671a      â†’ 0e342768416822451524974117254469
s214587387a      â†’ 0e848240448830187420162954587645
s1091221200a     â†’ 0e940624217856561557816327384675
s1885207154a     â†’ 0e509367213418206700842008763514
s1502113478a     â†’ 0e861580163291561247404381396064
s1885207154a     â†’ 0e509367213418206700842008763514
s1836677006a     â†’ 0e481036490867661113260034900752
s155964671a      â†’ 0e342768416822451524974117254469
s1184209335a     â†’ 0e072485820392773389523109082030
s1665632922a     â†’ 0e731198061491163073197128363787
s1502113478a     â†’ 0e861580163291561247404381396064
s1836677006a     â†’ 0e481036490867661113260034900752
s1885207154a     â†’ 0e509367213418206700842008763514
```

### 2. SHA1å¼±ç±»å‹ç»•è¿‡åˆé›†

```text
aaroZmOk        â†’ 0e66507019969427134894567494305185566735
aaK1STfY        â†’ 0e76658526655756207688271159624026011393
aaO8zKZF        â†’ 0e89257456677279068558073954252716165668
aa3OFF9m        â†’ 0e36977786278517984959260394024281014729
```

### 3. æ•°ç»„ç»•è¿‡é€šç”¨Payload

```text
# GETå‚æ•°
?a[]=1&b[]=2
?param1[]=123&param2[]=456

# POSTæ•°æ®
a[]=1&b[]=2
user[]=admin&pass[]=123456

# JSONæ ¼å¼
{"a":[],"b":[]}
{"user":[],"pass":[]}
```

### 4. ç»„åˆç»•è¿‡Payload

```php
// å¤šé‡éªŒè¯ç»•è¿‡ç¤ºä¾‹
if(md5($_POST['user']) == md5($_POST['pass']) && $_POST['user'] != $_POST['pass']){
    if(sha1($_POST['key1']) == sha1($_POST['key2']) && $_POST['key1'] != $_POST['key2']){
        echo "flag{xxx}";
    }
}

// ç»•è¿‡æ–¹æ³•ï¼š
// user[]=1&pass[]=2&key1[]=3&key2[]=4
```

---

## CTFå®æˆ˜æ¡ˆä¾‹

### æ¡ˆä¾‹1ï¼šåŒé‡MD5éªŒè¯ç»•è¿‡

```php
// æŒ‘æˆ˜ä»£ç 
if(isset($_GET['a']) && isset($_GET['b'])){
    if($_GET['a'] != $_GET['b'] && md5($_GET['a']) == md5($_GET['b'])){
        if(md5(md5($_GET['a'])) == md5(md5($_GET['b']))){
            echo $flag;
        }
    }
}

// è§£å†³æ–¹æ¡ˆ
// ?a[]=1&b[]=2
// md5(array()) è¿”å› NULL
// md5(NULL) ä¹Ÿè¿”å› NULL
// NULL == NULL ä¸º true
```

### æ¡ˆä¾‹2ï¼šJSON+MD5ç»„åˆç»•è¿‡

```php
// æŒ‘æˆ˜ä»£ç 
$data = json_decode($_POST['data'], true);
if(md5($data['password']) == "0"){
    echo $flag;
}

// è§£å†³æ–¹æ¡ˆ
// POST: data={"password":[]}
// md5(array()) è¿”å› NULL
// NULL == "0" ä¸º trueï¼ˆå¼±ç±»å‹æ¯”è¾ƒï¼‰
```

### æ¡ˆä¾‹3ï¼šæ–‡ä»¶ä¸Šä¼ MD5ç»•è¿‡

```php
// æŒ‘æˆ˜ä»£ç 
$upload_md5 = md5_file($_FILES['file']['tmp_name']);
if($upload_md5 == $target_md5){
    echo $flag;
}

// è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨MD5ç¢°æ’æ–‡ä»¶
```

---

## é«˜çº§ç»•è¿‡æŠ€å·§

### 1. é•¿åº¦æ‰©å±•æ”»å‡»

```python
# é’ˆå¯¹æŸäº›è‡ªå®šä¹‰å“ˆå¸Œç®—æ³•
def length_extension_attack(original_hash, original_length, append_data):
    # å®ç°é•¿åº¦æ‰©å±•æ”»å‡»
    pass
```

### 2. æ—¶é—´ç›²æ³¨ç»•è¿‡

```php
// åˆ©ç”¨MD5è®¡ç®—æ—¶é—´å·®å¼‚
if(md5($_GET['input']) == $secret_hash){
    // å¯èƒ½å­˜åœ¨æ—¶é—´å·®å¼‚
}
```

### 3. å†…å­˜å ç”¨æ”»å‡»

```php
// å¤§æ•°ç»„å¯èƒ½å¯¼è‡´å†…å­˜è€—å°½
if(md5($_POST['data']) == "target"){
    // $_POST['data'] ä¸ºè¶…å¤§æ•°ç»„æ—¶å¯èƒ½å¯¼è‡´DoS
}
```

---

## é˜²å¾¡ä¸æ£€æµ‹

### å®‰å…¨ç¼–ç å®è·µ

#### 1. ä½¿ç”¨å¼ºç±»å‹æ¯”è¾ƒ

```php
// âŒ å±é™©çš„å¼±ç±»å‹æ¯”è¾ƒ
if(md5($input) == $expected_hash)

// âœ… å®‰å…¨çš„å¼ºç±»å‹æ¯”è¾ƒ  
if(md5($input) === $expected_hash)
```

#### 2. è¾“å…¥éªŒè¯

```php
// âœ… éªŒè¯è¾“å…¥ç±»å‹
if(!is_string($_GET['input'])){
    die("Invalid input type");
}

if(md5($_GET['input']) === $expected_hash){
    echo "Valid";
}
```

#### 3. ä½¿ç”¨æ›´å¼ºçš„å“ˆå¸Œç®—æ³•

```php
// âœ… ä½¿ç”¨æ›´å®‰å…¨çš„å“ˆå¸Œç®—æ³•
hash('sha256', $input)
password_hash($password, PASSWORD_DEFAULT)  // ç”¨äºå¯†ç å“ˆå¸Œ
```

### ä»£ç å®¡è®¡è¦ç‚¹

#### æ£€æŸ¥æ¸…å•

- [ ] æ˜¯å¦ä½¿ç”¨äº†å¼±ç±»å‹æ¯”è¾ƒï¼ˆ`==`ï¼‰
- [ ] æ˜¯å¦å¯¹è¾“å…¥ç±»å‹è¿›è¡ŒéªŒè¯
- [ ] æ˜¯å¦ä½¿ç”¨äº†å®‰å…¨çš„å“ˆå¸Œç®—æ³•
- [ ] æ˜¯å¦å­˜åœ¨æ•°ç»„ç»•è¿‡å¯èƒ½æ€§
- [ ] æ˜¯å¦æœ‰JSONè§£æç›¸å…³çš„ç±»å‹æ··æ·†

#### å¸¸è§vulnerableæ¨¡å¼

```php
// ğŸš¨ å±é™©æ¨¡å¼1ï¼šç›´æ¥å¼±ç±»å‹æ¯”è¾ƒ
if(md5($_GET['input']) == $target)

// ğŸš¨ å±é™©æ¨¡å¼2ï¼šæœªéªŒè¯è¾“å…¥ç±»å‹
$data = json_decode($_POST['json'], true);
if(md5($data['key']) == $hash)

// ğŸš¨ å±é™©æ¨¡å¼3ï¼šæ•°ç»„æœªè¿‡æ»¤
if(md5($_POST['password']) == md5($_POST['confirm']))
```

---

## å·¥å…·ä¸èµ„æº

### åœ¨çº¿å·¥å…·

- **MD5è§£å¯†ç½‘ç«™**ï¼šcmd5.com, hashkiller.co.uk
- **å“ˆå¸Œç¢°æ’ç”Ÿæˆ**ï¼šGitHubä¸Šçš„å„ç§å·¥å…·
- **ç±»å‹è½¬æ¢æµ‹è¯•**ï¼šåœ¨çº¿PHPæ²™ç›’

### æœ¬åœ°å·¥å…·

```bash
# HashClash - MD5ç¢°æ’å·¥å…·
git clone https://github.com/cr-marcstevens/hashclash.git

# FastColl - å¿«é€ŸMD5ç¢°æ’
wget https://www.win.tue.nl/hashclash/fastcoll_v1.0.0.5.exe

# è‡ªå®šä¹‰è„šæœ¬ç”ŸæˆPayload
python3 generate_md5_collision.py
```

### å­¦ä¹ èµ„æº

- **CTF Wiki**ï¼šctf-wiki.org
- **OWASPæŒ‡å—**ï¼šç±»å‹æ··æ·†æ”»å‡»
- **å­¦æœ¯è®ºæ–‡**ï¼šMD5å’ŒSHA1ç¢°æ’ç ”ç©¶

---

## ğŸ“š æ€»ç»“

é€šè¿‡æœ¬æŒ‡å—ï¼Œä½ åº”è¯¥æŒæ¡ï¼š

âœ… **åŸºç¡€ç†è®º**ï¼š

- PHPå¼±ç±»å‹æ¯”è¾ƒæœºåˆ¶
- å„ç§å“ˆå¸Œå‡½æ•°çš„ç‰¹ç‚¹å’Œæ¼æ´

âœ… **å®æˆ˜æŠ€å·§**ï¼š

- MD5/SHA1å¼±ç±»å‹ç»•è¿‡æ–¹æ³•
- æ•°ç»„ç»•è¿‡å’ŒJSONç»•è¿‡æŠ€å·§
- ç¢°æ’æ”»å‡»çš„åº”ç”¨

âœ… **å®‰å…¨æ„è¯†**ï¼š

- å¦‚ä½•ç¼–å†™å®‰å…¨çš„å“ˆå¸ŒéªŒè¯ä»£ç 
- å¸¸è§æ¼æ´æ¨¡å¼çš„è¯†åˆ«
- é˜²å¾¡æªæ–½çš„å®æ–½

âœ… **CTFåº”ç”¨**ï¼š

- å¿«é€Ÿè¯†åˆ«å“ˆå¸Œç»•è¿‡é¢˜ç›®
- å¸¸ç”¨Payloadçš„ä½¿ç”¨
- é«˜çº§ç»•è¿‡æŠ€å·§çš„åº”ç”¨

**è®°ä½æ ¸å¿ƒåŸåˆ™**ï¼šå¼±ç±»å‹æ¯”è¾ƒæ˜¯ä¸‡æ¶ä¹‹æºï¼Œæ•°ç»„æ˜¯ç»•è¿‡ç¥å™¨ï¼Œå¼ºç±»å‹æ¯”è¾ƒ+è¾“å…¥éªŒè¯æ˜¯ç‹é“ï¼

---

_ğŸ’¡ æç¤ºï¼šå°†å¸¸ç”¨çš„Payloadä¿å­˜åˆ°ä½ çš„CTFå·¥å…·åŒ…ä¸­ï¼Œé‡åˆ°å“ˆå¸ŒéªŒè¯é¢˜ç›®æ—¶å¯ä»¥å¿«é€Ÿå°è¯•ï¼_