GOT ï¼šGlobal Offset Tableï¼Œå…¨å±€åç§»è¡¨
PLTï¼šProcedure Linkage Tableï¼Œè¿‡ç¨‹é“¾æ¥è¡¨

æŸ¥çœ‹.gotå’Œ.got.pltç­‰åœ°å€ï¼ˆæ— PIEï¼‰ï¼š
gdb
```bash
info files
```

# libc åˆ©ç”¨å¥—è·¯é€ŸæŸ¥è¡¨

## 1. **No RELROï¼šGOT è¦†å†™**

- **æ¡ä»¶**ï¼šç¨‹åºæ²¡å¼€ RELROï¼ˆæˆ–è€… Partial RELROï¼‰ï¼Œ`.got.plt` å¯å†™ã€‚
    
- **æ–¹æ³•**ï¼š
    
    1. æ³„éœ²æˆ–çŸ¥é“ `system` åœ°å€ã€‚
        
    2. ç”¨æ¼æ´å†™å†…å­˜ï¼ŒæŠŠæŸå‡½æ•°ï¼ˆå¦‚ `puts@GOT`ï¼‰æ”¹æˆ `system`ã€‚
        
    3. å†è°ƒç”¨ `puts("sh")` â†’ å®é™…å˜æˆ `system("sh")`ã€‚
        
- **ä¼˜ç‚¹**ï¼špayload ç®€å•ï¼Œå¾€å¾€ä¸€å‘å…¥é­‚ã€‚
    
- **ç¼ºç‚¹**ï¼šå¦‚æœ Full RELRO å¼€å¯ï¼ŒGOT å˜æˆåªè¯»ï¼Œå°±ä¸èƒ½ç”¨äº†ã€‚
    

---

## 2. **ret2libcï¼ˆç»å…¸æ–¹å¼ï¼‰**

- **æ¡ä»¶**ï¼šå †æ ˆå¯æ§ï¼Œå¯ä»¥æ„é€  ROPï¼›ä¸€èˆ¬éœ€è¦èƒ½â€œæ³„éœ² libc åœ°å€â€ã€‚
    
- **æ–¹æ³•**ï¼š
    
    1. æ³„éœ² libc ä¸­ä»»æ„å‡½æ•°ï¼ˆæ¯”å¦‚ `puts@got`ï¼‰çš„å®é™…åœ°å€ã€‚
        
    2. æ ¹æ®å·²çŸ¥ libc ç‰ˆæœ¬çš„ç¬¦å·è¡¨ï¼Œç®—å‡º **libc åŸºå€**ã€‚
        
        `libc_base = leaked_puts - libc.symbols['puts']`
        
    3. æ ¹æ®åŸºå€ + åç§»ï¼Œæ‹¿åˆ° `system` å’Œ `"/bin/sh"` å­—ç¬¦ä¸²åœ°å€ã€‚
        
    4. æ„é€  ROP è°ƒç”¨ `system("/bin/sh")`ã€‚
        
- **ä¼˜ç‚¹**ï¼šé€šç”¨æ€§æœ€å¼ºï¼Œå‡ ä¹æ‰€æœ‰é¢˜éƒ½èƒ½ç”¨ã€‚
    
- **ç¼ºç‚¹**ï¼šéœ€è¦ä¿¡æ¯æ³„éœ²ï¼Œä¸”éœ€è¦çŸ¥é“ libc çš„ç‰ˆæœ¬ã€‚
    

---

## 3. **one_gadget**

- **æ¡ä»¶**ï¼šçŸ¥é“ libc ç‰ˆæœ¬ï¼Œèƒ½æ§åˆ¶ RIP/EIPã€‚
    
- **æ–¹æ³•**ï¼š
    
    1. ç”¨ `one_gadget libc.so.6` å·¥å…·æ‰¾å‡ºæ»¡è¶³æ¡ä»¶çš„ gadget åç§»ã€‚
        
    2. æ³„éœ² libc åŸºå€ã€‚
        
    3. è·³åˆ° `libc_base + one_gadget_offset`ã€‚
        
- **ä¼˜ç‚¹**ï¼špayload çŸ­å°ï¼Œé€šå¸¸åªéœ€ä¸€æ¬¡è·³è½¬å°±èƒ½ getshellã€‚
    
- **ç¼ºç‚¹**ï¼šone_gadget æœ‰**çº¦æŸæ¡ä»¶**ï¼ˆå¦‚ `rsp+0x30 == NULL`ï¼‰ï¼Œå¹¶ä¸ä¸€å®šèƒ½æ»¡è¶³ã€‚
    

---

## 4. **ret2csuï¼ˆæˆ– ret2dlresolveï¼‰**

- **é€‚ç”¨åœºæ™¯**ï¼š
    
    - ret2csuï¼šç¨‹åºé‡Œæ²¡æœ‰ç°æˆçš„ `pop rdi` ç­‰ gadgetsï¼Œéœ€è¦ç”¨ `__libc_csu_init` ä¸­çš„ gadget æ¥æ„é€ ä»»æ„å‡½æ•°è°ƒç”¨ã€‚
        
    - ret2dlresolveï¼šç¨‹åºæ²¡æœ‰ `system` æˆ–è€…ç¼ºå°‘æŸäº›ç¬¦å·ï¼Œå¯ä»¥ä¼ªé€ ä¸€ä¸ª `dl_resolve` ç»“æ„æ¥è°ƒç”¨åŠ¨æ€é“¾æ¥å™¨è§£æä»»æ„å‡½æ•°ï¼ˆå¦‚ `system`ï¼‰ã€‚
        
- **ä¼˜ç‚¹**ï¼šè§£å†³ gadget ä¸å…¨ã€ç¬¦å·ç¼ºå¤±çš„é—®é¢˜ã€‚
    
- **ç¼ºç‚¹**ï¼špayload æ¯”è¾ƒå¤æ‚ï¼Œä¸€èˆ¬æ˜¯è¿›é˜¶é¢˜ã€‚
    

---

## 5. **Format String + libc**

- **æ¡ä»¶**ï¼šå­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚
    
- **æ–¹æ³•**ï¼š
    
    1. ç”¨ `%p` / `%s` ç­‰æ³„éœ² GOT/æ ˆ/è¿”å›åœ°å€ï¼Œè¿›è€Œæ³„éœ² libcã€‚
        
    2. ç”¨ `%n` å¾€ GOT å†™å…¥ `system` åœ°å€ã€‚
        
    3. æˆ–è€…ç›´æ¥æ„é€  ROP è·³ libcã€‚
        
- **ä¼˜ç‚¹**ï¼šæ ¼å¼åŒ–å­—ç¬¦ä¸²é¢˜é‡Œå‡ ä¹å¿…ç”¨å¥—è·¯ã€‚
    
- **ç¼ºç‚¹**ï¼šéœ€è¦ä»”ç»†ç®—åç§»ï¼Œå®¹æ˜“è°ƒè¯•åŠå¤©ã€‚
    

---

## ğŸ“Œ é€‚ç”¨åœºæ™¯é€ŸæŸ¥

|åœºæ™¯|æœ€ä¼˜è§£|
|---|---|
|**No RELRO**|GOT è¦†å†™|
|**Partial/Full RELRO** + å¯æ³„éœ²åœ°å€|ret2libc|
|**Full RELRO** + æ²¡æœ‰ç°æˆ gadget|ret2csu / ret2dlresolve|
|**å·²çŸ¥ libcï¼Œèƒ½æ§ RIP**|one_gadget|
|**æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´**|æ³„éœ² libc + GOT æ”¹å†™ / ret2libc|

---

## ğŸš€ å°æŠ€å·§

- **ç¡®è®¤ libc ç‰ˆæœ¬**ï¼š
    
    - æœ¬åœ° `ldd ./pwn` â†’ æ‰¾åˆ° `libc.so.6` è·¯å¾„ã€‚
        
    - æˆ–è¿œç¨‹çˆ†ç ´ libc ç‰ˆæœ¬ï¼ˆç”¨ `libc-database`ï¼‰ã€‚
        
- **pwntools è„šæœ¬å¸¸ç”¨**ï¼š
    
    `from pwn import * elf = ELF('./pwn') libc = ELF('/lib/x86_64-linux-gnu/libc.so.6')  # æˆ–libc-databaseåŒ¹é…åˆ°çš„ç‰ˆæœ¬  # æ³„éœ²putsåœ°å€ puts_got = elf.got['puts'] puts_plt = elf.plt['puts']  # è®¡ç®—åŸºå€ libc_base = leaked_puts - libc.symbols['puts'] system = libc_base + libc.symbols['system'] binsh = libc_base + next(libc.search(b"/bin/sh"))`
    
- **one_gadget ä½¿ç”¨**ï¼š
    
    `one_gadget libc.so.6`